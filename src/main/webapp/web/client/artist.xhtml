<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                template="/web/client/clientTemplate.xhtml">

    <!-- ================= METADATA ================= -->
    <f:metadata>
        <f:viewParam name="id"
                     value="#{clientArtistProfileBean.artistId}"
                     required="true"/>
        <f:event type="preRenderView"
                 listener="#{clientArtistProfileBean.loadArtist}"/>
    </f:metadata>

    <ui:define name="title">
        Artist Profile — #{clientArtistProfileBean.artist.fullName}
    </ui:define>

    <ui:define name="content">

        <h:form id="artistForm">
            <p:growl id="msg" showDetail="true"/>

            <style>
                .profile-header {
                    display: flex;
                    gap: 40px;
                    padding: 40px 0;
                    border-bottom: 1px solid #eee;
                }

                .profile-avatar {
                    width: 140px;
                    height: 140px;
                    border-radius: 50%;
                    background: linear-gradient(135deg,#667eea,#764ba2);
                    color: white;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 60px;
                    font-weight: bold;
                }

                .profile-stats {
                    display: flex;
                    gap: 30px;
                    margin-top: 15px;
                }

                .designs-grid {
                    display: grid;
                    grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
                    gap: 20px;
                    margin-top: 20px;
                }

                .design-card {
                    border-radius: 10px;
                    overflow: hidden;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
                    transition: transform .2s;
                }

                .design-card:hover {
                    transform: translateY(-4px);
                }

                .design-image {
                    width: 100%;
                    height: 260px;
                    object-fit: cover;
                }
            </style>

            <!-- ================= PROFILE ================= -->
            <h:panelGroup rendered="#{clientArtistProfileBean.loaded}">

                <div class="profile-header">

                    <div class="profile-avatar">
#{clientArtistProfileBean.artist.fullName.substring(0,1)}
                    </div>

                    <div>
                        <h1>#{clientArtistProfileBean.artist.fullName}</h1>
                        <p>Email: #{clientArtistProfileBean.artist.email}</p>

                        <div class="profile-stats">
                            <span>
                                <strong>★ #{clientArtistProfileBean.artist.averageRating}</strong>
                                Rating
                            </span>
                            <span>
                                <strong>#{clientArtistProfileBean.artist.totalReviews}</strong>
                                Reviews
                            </span>
                            <span>
                                <strong>#{clientArtistProfileBean.artist.designs.size()}</strong>
                                Designs
                            </span>
                        </div>

<!--                       <p:button value="Book Appointment"
          outcome="/web/client/book.xhtml"
          icon="pi pi-calendar"
          style="margin-top:20px"/>-->

                    </div>

                </div>

                <!-- ================= TABS ================= -->
                <p:tabView>

                    <!-- ===== DESIGNS ===== -->
                    <p:tab title="Designs">

                        <div class="designs-grid">

                            <ui:repeat value="#{clientArtistProfileBean.artist.designs}" var="design">

                                <h:link outcome="/web/client/design.xhtml">
                                    <f:param name="id" value="#{design.designId}"/>

                                    <div class="design-card">
                                        <h:graphicImage value="#{design.imagePath}"
                                                        styleClass="design-image"/>
                                    </div>
                                </h:link>

                            </ui:repeat>

                        </div>

                    </p:tab>

                    <!-- ===== REVIEW SUBMISSION ===== -->
                    <p:tab title="Leave Review">

                        <p:panel header="Your Review">

                            <p:rating value="#{clientArtistProfileBean.reviewRating}"
                                      stars="5"
                                      cancel="false"/>

                            <p:inputTextarea value="#{clientArtistProfileBean.reviewComment}"
                                             rows="4"
                                             placeholder="Write your experience..."
                                             style="width:100%; margin-top:10px"/>

                            <p:commandButton value="Submit Review"
                                             action="#{clientArtistProfileBean.submitReview}"
                                             ajax="false"
                                             style="margin-top:15px"/>

                        </p:panel>

                    </p:tab>

                </p:tabView>

            </h:panelGroup>

            <!-- ================= ERROR ================= -->
            <h:panelGroup rendered="#{!clientArtistProfileBean.loaded}">
                <h3 style="text-align:center; color:red;">
                    Artist profile not found.
                </h3>
            </h:panelGroup>

        </h:form>

    </ui:define>
</ui:composition>
