<ui:composition
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:p="http://primefaces.org/ui"
    template="/web/client/clientTemplate.xhtml">

    <f:metadata>
        <f:viewParam name="id" value="#{designDetailBean.designId}" />
<f:viewAction action="#{designDetailBean.loadDesign}" onPostback="false" />
    </f:metadata>

    <ui:define name="title">
        #{designDetailBean.designLoaded ? designDetailBean.design.title : 'Design Not Found'}
    </ui:define>

    <ui:define name="content">

        <!-- ======================= STYLES ======================= -->
        <style>
            /* Main Layout */
            .page-wrapper {
                max-width: 1200px;
                margin: 0 auto;
                padding: 20px;
            }
            
            .card {
                background: white;
                border-radius: 12px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.08);
                padding: 24px;
                margin-bottom: 24px;
                border: 1px solid #e9ecef;
            }
            
            /* Design Grid */
            .design-grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 32px;
                align-items: start;
            }
            
            @media (max-width: 768px) {
                .design-grid {
                    grid-template-columns: 1fr;
                }
            }
            
            .design-img {
                width: 100%;
                height: auto;
                max-height: 500px;
                object-fit: contain;
                border-radius: 8px;
                cursor: zoom-in;
                transition: transform 0.3s ease;
                background: #f8f9fa;
                border: 1px solid #dee2e6;
            }
            
            .design-img:hover {
                transform: scale(1.01);
            }
            
            /* Style Badge */
            .style-badge {
                display: inline-block;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                padding: 6px 16px;
                border-radius: 20px;
                font-size: 14px;
                font-weight: 600;
                margin-bottom: 16px;
                box-shadow: 0 2px 4px rgba(102, 126, 234, 0.2);
            }
            
            /* Design Details Grid */
            .design-details {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 16px;
                margin: 24px 0;
                padding: 20px;
                background: #f8f9fa;
                border-radius: 10px;
                border: 1px solid #e9ecef;
            }
            
            .detail-item {
                display: flex;
                flex-direction: column;
                gap: 4px;
            }
            
            .detail-label {
                font-size: 12px;
                color: #6c757d;
                text-transform: uppercase;
                letter-spacing: 0.5px;
                font-weight: 600;
            }
            
            .detail-value {
                font-size: 16px;
                color: #212529;
                font-weight: 600;
            }
            
            /* Button Styles */
            .btn-row {
                display: flex;
                flex-wrap: wrap;
                gap: 12px;
                margin-top: 24px;
            }
            
            .btn {
                padding: 12px 24px;
                border-radius: 8px;
                font-weight: 600;
                font-size: 14px;
                cursor: pointer;
                text-decoration: none;
                display: inline-flex;
                align-items: center;
                justify-content: center;
                gap: 8px;
                transition: all 0.3s ease;
                border: none;
                min-width: 140px;
            }
            
            /* LIKE BUTTON */
            .btn-like {
                background: linear-gradient(135deg, #ff6b6b 0%, #ff8e8e 100%);
                color: white;
                border: 2px solid #ff6b6b;
            }
            
            .btn-like.active {
                background: linear-gradient(135deg, #ff4757 0%, #ff6b6b 100%);
                box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
            }
            
            .btn-like:hover:not(:disabled) {
                transform: translateY(-2px);
                box-shadow: 0 6px 16px rgba(255, 107, 107, 0.3);
            }
            
            /* FAVOURITE BUTTON */
            .btn-fav {
                background: linear-gradient(135deg, #ffd93d 0%, #ffb347 100%);
                color: #212529;
                border: 2px solid #ffd93d;
            }
            
            .btn-fav.active {
                background: linear-gradient(135deg, #ffc107 0%, #ffd93d 100%);
                box-shadow: 0 4px 12px rgba(255, 193, 7, 0.3);
            }
            
            .btn-fav:hover:not(:disabled) {
                transform: translateY(-2px);
                box-shadow: 0 6px 16px rgba(255, 193, 7, 0.3);
            }
            
            /* BOOK APPOINTMENT BUTTON */
            .btn-book {
                background: linear-gradient(135deg, #4dabf7 0%, #339af0 100%);
                color: white;
                border: 2px solid #4dabf7;
                text-decoration: none !important;
            }
            
            .btn-book:hover {
                background: linear-gradient(135deg, #339af0 0%, #228be6 100%);
                transform: translateY(-2px);
                box-shadow: 0 6px 16px rgba(51, 154, 240, 0.3);
            }
            
            /* VIEW ARTIST PROFILE BUTTON */
            .btn-artist-profile {
                background: linear-gradient(135deg, #9c88ff 0%, #8c7ae6 100%);
                color: white;
                border: 2px solid #9c88ff;
                text-decoration: none !important;
                padding: 10px 20px;
                font-size: 14px;
            }
            
            .btn-artist-profile:hover {
                background: linear-gradient(135deg, #8c7ae6 0%, #7d6bcc 100%);
                transform: translateY(-2px);
                box-shadow: 0 6px 16px rgba(156, 136, 255, 0.3);
            }
            
            /* Artist Trust Section */
            .artist-box {
                display: flex;
                align-items: center;
                gap: 20px;
                padding: 20px;
                background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
                border-radius: 12px;
                border: 1px solid #dee2e6;
            }
            
            .artist-avatar {
                width: 80px;
                height: 80px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 32px;
                color: white;
                font-weight: bold;
                box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
            }
            
            .artist-info {
                flex: 1;
            }
            
            .artist-rating {
                display: flex;
                align-items: center;
                gap: 12px;
                margin: 12px 0;
                flex-wrap: wrap;
            }
            
            .rating-stars {
                color: #ffc107;
                font-size: 20px;
            }
            
            /* Comments Section */
            .comments-section {
                margin-top: 32px;
            }
            
            .comment-form {
                background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
                padding: 24px;
                border-radius: 12px;
                margin-bottom: 24px;
                border: 1px solid #dee2e6;
            }
            
            .comment-input {
                width: 100%;
                padding: 16px;
                border: 2px solid #dee2e6;
                border-radius: 8px;
                margin-bottom: 16px;
                resize: vertical;
                min-height: 100px;
                font-family: inherit;
                font-size: 14px;
                transition: border-color 0.3s ease;
            }
            
            .comment-input:focus {
                outline: none;
                border-color: #4dabf7;
                box-shadow: 0 0 0 3px rgba(77, 171, 247, 0.1);
            }
            
            .comment-btn {
                background: linear-gradient(135deg, #40c057 0%, #2f9e44 100%);
                color: white;
                border: none;
                padding: 12px 28px;
                border-radius: 8px;
                cursor: pointer;
                font-weight: 600;
                font-size: 14px;
                transition: all 0.3s ease;
            }
            
            .comment-btn:hover:not(:disabled) {
                transform: translateY(-2px);
                box-shadow: 0 6px 16px rgba(64, 192, 87, 0.3);
            }
            
            .comment-btn:disabled {
                background: #adb5bd;
                cursor: not-allowed;
                transform: none !important;
                box-shadow: none !important;
            }
            
            .comments-list {
                margin-top: 24px;
            }
            
            .comment-card {
                background: white;
                border: 1px solid #e9ecef;
                border-radius: 10px;
                padding: 20px;
                margin-bottom: 16px;
                transition: transform 0.3s ease, box-shadow 0.3s ease;
            }
            
            .comment-card:hover {
                transform: translateY(-2px);
                box-shadow: 0 8px 24px rgba(0,0,0,0.1);
            }
            
            .comment-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 12px;
                flex-wrap: wrap;
                gap: 8px;
            }
            
            .comment-author {
                font-weight: 700;
                color: #495057;
                font-size: 16px;
            }
            
            .comment-date {
                color: #6c757d;
                font-size: 13px;
                background: #f8f9fa;
                padding: 4px 12px;
                border-radius: 20px;
            }
            
            .comment-content {
                color: #212529;
                line-height: 1.6;
                font-size: 15px;
            }
            
            .no-comments {
                text-align: center;
                color: #6c757d;
                padding: 48px;
                background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
                border-radius: 12px;
                font-style: italic;
                font-size: 16px;
                border: 2px dashed #ced4da;
            }
            
            /* Related Designs */
            .related-row {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
                gap: 20px;
                margin-top: 20px;
            }
            
            .related-card {
                background: white;
                border: 1px solid #e9ecef;
                border-radius: 10px;
                overflow: hidden;
                transition: all 0.3s ease;
            }
            
            .related-card:hover {
                transform: translateY(-4px);
                box-shadow: 0 12px 28px rgba(0,0,0,0.12);
            }
            
            .related-card .design-img {
                height: 200px;
                object-fit: cover;
                border-radius: 0;
                border: none;
            }
            
            .related-info {
                padding: 16px;
            }
            
            /* Modal Styles */
            .modal {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.95);
                z-index: 10000;
                align-items: center;
                justify-content: center;
                padding: 20px;
            }
            
            .modal-content {
                max-width: 90%;
                max-height: 90%;
                position: relative;
            }
            
            .modal-content img {
                max-width: 100%;
                max-height: 80vh;
                object-fit: contain;
                border-radius: 8px;
                box-shadow: 0 20px 60px rgba(0,0,0,0.4);
            }
            
            .modal-close {
                position: absolute;
                top: 20px;
                right: 20px;
                background: rgba(255,255,255,0.1);
                border: 2px solid rgba(255,255,255,0.3);
                color: white;
                width: 50px;
                height: 50px;
                border-radius: 50%;
                font-size: 24px;
                cursor: pointer;
                z-index: 10001;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: all 0.3s ease;
                backdrop-filter: blur(10px);
            }
            
            .modal-close:hover {
                background: rgba(255,255,255,0.2);
                transform: rotate(90deg);
            }
            
            /* Global Messages */
            .global-messages {
                margin-bottom: 20px;
            }
            
            .error-message {
                background: linear-gradient(135deg, #ff6b6b 0%, #ff4757 100%);
                color: white;
                padding: 16px;
                border-radius: 8px;
                margin-bottom: 16px;
                border: none;
            }
            
            .success-message {
                background: linear-gradient(135deg, #40c057 0%, #2f9e44 100%);
                color: white;
                padding: 16px;
                border-radius: 8px;
                margin-bottom: 16px;
                border: none;
            }
            
            /* Responsive Adjustments */
            @media (max-width: 576px) {
                .design-details {
                    grid-template-columns: 1fr;
                }
                
                .btn-row {
                    flex-direction: column;
                }
                
                .btn {
                    width: 100%;
                }
                
                .artist-box {
                    flex-direction: column;
                    text-align: center;
                }
                
                .artist-info {
                    text-align: center;
                }
            }
            
            /* Typography */
            h2 {
                color: #212529;
                margin: 0 0 16px 0;
                font-size: 28px;
                font-weight: 700;
            }
            
            h3 {
                color: #343a40;
                margin: 0 0 20px 0;
                font-size: 22px;
                font-weight: 600;
                position: relative;
                padding-bottom: 12px;
            }
            
            h3:after {
                content: '';
                position: absolute;
                bottom: 0;
                left: 0;
                width: 60px;
                height: 3px;
                background: linear-gradient(135deg, #4dabf7 0%, #339af0 100%);
                border-radius: 3px;
            }
            
            h4 {
                color: #212529;
                margin: 0;
                font-size: 18px;
                font-weight: 600;
            }
        </style>

        <div class="page-wrapper">
            <h:form id="designForm">

                <!-- ===== GLOBAL MESSAGES ===== -->
                <h:messages id="messages"
            globalOnly="true"
            styleClass="global-messages"
            errorClass="error-message"
            infoClass="success-message"/>


                <!-- ===== DESIGN NOT FOUND ===== -->
                <h:panelGroup rendered="#{not designDetailBean.designLoaded}">
                    <div class="card" style="text-align:center">
                        <h2>Design Not Found</h2>
                        <h:link outcome="/web/client/home.xhtml"
                                styleClass="btn btn-book"
                                value="Back to Home"/>
                    </div>
                </h:panelGroup>

                <!-- ===== MAIN CONTENT ===== -->
                <h:panelGroup rendered="#{designDetailBean.designLoaded}">

                    <!-- ===== DESIGN SHOWCASE ===== -->
                    <div class="card design-grid">

                        <!-- IMAGE WITH ZOOM/LIGHTBOX -->
                        <div>
                            <h:graphicImage
                                value="#{designDetailBean.designImageUrl}"
                                styleClass="design-img"
                                onclick="openModal(this.src)"
                                alt="#{designDetailBean.design.title}"/>
                            <p style="text-align:center; margin-top:12px; color:#666; font-size:14px;">
                                <small>Click image to zoom</small>
                            </p>
                        </div>

                        <!-- DESIGN DETAILS -->
                        <div>
                            <!-- Style Tag -->
                            <span class="style-badge">
                                #{designDetailBean.design.style}
                            </span>

                            <!-- Title & Description -->
                            <h2>#{designDetailBean.design.title}</h2>
                            <p style="color:#555; line-height:1.7; font-size:16px; margin-bottom:24px;">#{designDetailBean.design.description}</p>

                            <!-- Design Details Grid -->
                            <div class="design-details">
    <div class="detail-item">
        <span class="detail-label">Price</span>
        <span class="detail-value">
            #{not empty designDetailBean.design.price ? '‚Çπ' += designDetailBean.design.price : 'Custom Quote'}
        </span>
    </div>
    
    <div class="detail-item">
        <span class="detail-label">Likes</span>
        <span class="detail-value">
            <!-- Make sure this ID matches what you render in AJAX -->
            <h:outputText id="likeCount" value="#{designDetailBean.likeCount}"/>
        </span>
    </div>
    
    <div class="detail-item">
        <span class="detail-label">Style</span>
        <span class="detail-value">#{designDetailBean.design.style}</span>
    </div>
    
    <div class="detail-item">
        <span class="detail-label">Uploaded</span>
        <span class="detail-value">
            <h:outputText value="#{designDetailBean.design.uploadedAt}">
                <f:convertDateTime pattern="MMM dd, yyyy" type="localDateTime"/>
            </h:outputText>
        </span>
    </div>
</div>
                            <!-- INTERACTION BUTTONS -->
<div class="btn-row">
    <!-- LIKE BUTTON -->
    <h:commandButton id="likeBtn"
        value="#{designDetailBean.liked ? '‚ù§Ô∏è Liked' : 'ü§ç Like'}"
        action="#{designDetailBean.toggleLike}"
        styleClass="btn btn-like #{designDetailBean.liked ? 'active' : ''}"
        rendered="#{designDetailBean.clientLoggedIn}">
        
        <f:ajax execute="@this" render="likeCount likeBtn favBtn messages"/>
    </h:commandButton>
    
    <h:outputText value="Login to like"
        styleClass="btn btn-like"
        rendered="#{not designDetailBean.clientLoggedIn}"/>

    <!-- FAVOURITE BUTTON -->
    <h:commandButton id="favBtn"
        value="#{designDetailBean.favourited ? '‚≠ê Remove From Save' : '‚òÜ Save Design'}"
        action="#{designDetailBean.toggleFavourite}"
        styleClass="btn btn-fav #{designDetailBean.favourited ? 'active' : ''}"
        rendered="#{designDetailBean.clientLoggedIn}">
        
        <f:ajax execute="@this" render="likeCount favBtn likeBtn messages"/>
    </h:commandButton>
    
    <h:outputText value="Login to favourite"
        styleClass="btn btn-fav"
        rendered="#{not designDetailBean.clientLoggedIn}"/>

                                <!-- BOOK APPOINTMENT -->
                                <h:link outcome="/web/client/book.xhtml"
                                        styleClass="btn btn-book">
                                    <f:param name="designId"
                                             value="#{designDetailBean.design.designId}"/>
                                    <f:param name="artistId"
                                             value="#{designDetailBean.artist.userId}"/>
                                    üìÖ Book Appointment
                                </h:link>

                            </div>
                        </div>
                    </div>

                    <!-- ===== ARTIST TRUST SECTION ===== -->
                    <div class="card">
                        <h3>About the Artist</h3>
                        
                        <div class="artist-box">
                            <div class="artist-avatar">
                                #{designDetailBean.artist.fullName.substring(0,1)}
                            </div>
                            
                            <div class="artist-info">
                                <h4 style="margin:0 0 10px 0;">#{designDetailBean.artist.fullName}</h4>
                                
                                <div class="artist-rating">
                                    <span class="rating-stars">
                                        <h:outputText value="‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ" rendered="#{designDetailBean.artistAverageRating >= 4.5}"/>
<h:outputText value="‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ" rendered="#{designDetailBean.artistAverageRating >= 3.5 and designDetailBean.artistAverageRating &lt; 4.5}"/>
<h:outputText value="‚òÖ‚òÖ‚òÖ‚òÜ‚òÜ" rendered="#{designDetailBean.artistAverageRating >= 2.5 and designDetailBean.artistAverageRating &lt; 3.5}"/>
<h:outputText value="‚òÖ‚òÖ‚òÜ‚òÜ‚òÜ" rendered="#{designDetailBean.artistAverageRating >= 1.5 and designDetailBean.artistAverageRating &lt; 2.5}"/>
<h:outputText value="‚òÖ‚òÜ‚òÜ‚òÜ‚òÜ" rendered="#{designDetailBean.artistAverageRating &lt; 1.5}"/>
                                    </span>
                                    <span style="font-weight:600; color:#495057;">#{designDetailBean.artistAverageRating}/5.0</span>
                                    <span style="color:#6c757d;">(#{designDetailBean.artistTotalReviews} reviews)</span>
                                </div>
                                
                                <p style="color:#666; margin:12px 0; font-size:15px;">
                                    Experience: #{not empty designDetailBean.artist.experience ? designDetailBean.artist.experience.yearsExperience : 'Not specified'} years
                                </p>
                                
                                <!-- VIEW ARTIST PROFILE BUTTON - FIXED -->
                                 <h:link outcome="/web/client/artist.xhtml"
                                styleClass="btn-artist-profile">
                            <f:param name="id"
                                     value="#{designDetailBean.artist.userId}"/>
                            üë®‚Äçüé® View Artist Profile ‚Üí
                        </h:link>
                            </div>
                        </div>
                    </div>

                   

                    <!-- ===== RELATED DESIGNS ===== -->
                    <div class="card"
                         rendered="#{not empty designDetailBean.relatedDesigns}">
                        <h3>Related Designs</h3>
                        
                        <div class="related-row">
                            <ui:repeat value="#{designDetailBean.relatedDesigns}" var="d">
                                <div class="related-card">
                                    <h:graphicImage
                                        value="#{d.imagePath}"
                                        styleClass="design-img"
                                        onclick="openModal('#{d.imagePath}')"/>
                                    
                                    <div class="related-info">
                                        <b>#{d.title}</b><br/>
                                        <small style="color:#666;">#{d.style}</small><br/>
                                        
                                        <h:link outcome="/web/client/design.xhtml"
                                                style="text-decoration:none; color:#007bff; font-size:0.9em;">
                                            <f:param name="id"
                                                     value="#{d.designId}"/>
                                            View Design ‚Üí
                                        </h:link>
                                    </div>
                                </div>
                            </ui:repeat>
                        </div>
                    </div>

                </h:panelGroup>
</h:form>
        </div>

        <!-- ===== IMAGE MODAL ===== -->
        <div id="imgModal" class="modal" onclick="closeModal()">
            <button class="modal-close" onclick="closeModal()">√ó</button>
            <div class="modal-content">
                <img id="modalImg"/>
            </div>
        </div>

        <!-- ===== JAVASCRIPT ===== -->
        <script>
            function openModal(src) {
                document.getElementById('imgModal').style.display = 'flex';
                document.getElementById('modalImg').src = src;
                document.body.style.overflow = 'hidden';
            }
            
            function closeModal() {
                document.getElementById('imgModal').style.display = 'none';
                document.body.style.overflow = 'auto';
            }
            
            // Close modal with Escape key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeModal();
                }
            });
            
            // Prevent modal click from closing when clicking image
            document.querySelector('.modal-content').addEventListener('click', function(e) {
                e.stopPropagation();
            });
        </script>

    </ui:define>
</ui:composition>