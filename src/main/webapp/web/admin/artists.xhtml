<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                template="/web/templates/layout.xhtml">

    <ui:define name="title">Admin â€” Artists | InkFlow</ui:define>
    <ui:define name="pageTitle">Artists</ui:define>

    <ui:define name="content">
        <h:form id="artistsForm">

            <!-- Growl for feedback -->
            <p:growl id="msgs" showDetail="true" life="3500" />

            <!-- Artists Table -->
            <p:dataTable id="artistsTable"
                         value="#{adminArtistsBean.artists}"
                         var="a"
                         rows="12"
                         paginator="true"
                         paginatorPosition="bottom"
                         emptyMessage="No artists found."
                         styleClass="ui-datatable"
                         rowKey="#{a.userId}">

                <p:column headerText="ID" style="width:70px">
                    <h:outputText value="#{a.userId}" />
                </p:column>

                <p:column headerText="Name">
                    <h:outputText value="#{a.fullName}" /><br/>
                    <small class="muted">#{a.username}</small>
                </p:column>

                <p:column headerText="Email">
                    <h:outputText value="#{a.email}" />
                </p:column>

                <p:column headerText="Phone" style="width:120px">
                    <h:outputText value="#{a.phone}" />
                </p:column>

                <p:column headerText="Created" style="width:160px">
                    <h:outputText value="#{a.createdAt}" />
                </p:column>

                <p:column headerText="Status" style="width:160px">
                    <h:outputText value="#{a.isActive ? 'Active' : 'Deactivated'}" /><br/>
                    <h:outputText value="#{a.isVerified ? 'Verified' : 'Unverified'}"/>
                </p:column>

                <p:column headerText="Actions" style="width:260px">
                    <!-- VIEW -->
                    <p:commandButton icon="pi pi-eye" title="View"
                 actionListener="#{adminArtistsBean.viewArtist(a.userId)}"
                 update=":artistsForm:artistDialogWrapper :artistsForm:msgs"
                 process="@this"
                 oncomplete="PF('artistDlg').show()" />


                    
                    <!-- ACTIVATE / DEACTIVATE -->
                    <p:commandButton icon="#{a.isActive ? 'pi pi-ban' : 'pi pi-check'}"
                                     title="#{a.isActive ? 'Deactivate' : 'Activate'}"
                                     update=":artistsForm:artistsTable :artistsForm:msgs"
                                     process="@this"
                                     actionListener="#{adminArtistsBean.toggleActive(a.userId, not a.isActive)}"
                                     style="margin-left:6px" />

                    <!-- VERIFY / UNVERIFY -->
                    <p:commandButton icon="pi pi-shield" title="Verify"
                                     rendered="#{not a.isVerified}"
                                     update=":artistsForm:artistsTable :artistsForm:msgs"
                                     process="@this"
                                     actionListener="#{adminArtistsBean.verifyArtist(a.userId, true)}"
                                     style="margin-left:6px" />

                    <p:commandButton icon="pi pi-times" title="Unverify"
                                     rendered="#{a.isVerified}"
                                     update=":artistsForm:artistsTable :artistsForm:msgs"
                                     process="@this"
                                     actionListener="#{adminArtistsBean.verifyArtist(a.userId, false)}"
                                     style="margin-left:6px" />

                    <!-- DELETE -->
                    <p:commandButton icon="pi pi-trash" title="Delete"
                                     rendered="#{a.role.roleName ne 'ADMIN'}"
                                     onclick="PF('confirmDel').show(); return false;"
                                     process="@this"
                                     style="margin-left:6px">
                        <f:setPropertyActionListener target="#{adminArtistsBean.artistToDeleteId}" value="#{a.userId}" />
                    </p:commandButton>
                </p:column>
            </p:dataTable>

            <!-- View Dialog -->
            <h:panelGroup id="artistDialogWrapper">
    <p:dialog id="artistViewDialog"
              widgetVar="artistDlg"
              header="Artist Details"
              modal="true"
              resizable="false"
              appendTo="@(body)">
              
        <h:panelGrid columns="2" columnClasses="label-col,value-col" style="width:100%">
            <h:outputText value="ID:" /><h:outputText value="#{adminArtistsBean.viewingArtist.userId}" />
            <h:outputText value="Full Name:" /><h:outputText value="#{adminArtistsBean.viewingArtist.fullName}" />
            <h:outputText value="Username:" /><h:outputText value="#{adminArtistsBean.viewingArtist.username}" />
            <h:outputText value="Email:" /><h:outputText value="#{adminArtistsBean.viewingArtist.email}" />
            <h:outputText value="Phone:" /><h:outputText value="#{adminArtistsBean.viewingArtist.phone}" />
            <h:outputText value="Active:" /><h:outputText value="#{adminArtistsBean.viewingArtist.active ? 'Yes' : 'No'}" />
            <h:outputText value="Verified:" /><h:outputText value="#{adminArtistsBean.viewingArtist.isVerified ? 'Yes' : 'No'}" />
        </h:panelGrid>

        <f:facet name="footer">
            <p:commandButton value="Close" type="button" onclick="PF('artistDlg').hide()" />
        </f:facet>

    </p:dialog>
</h:panelGroup>



            <!-- Confirm Delete -->
            <p:confirmDialog widgetVar="confirmDel"
                             header="Confirm Delete"
                             message="Are you sure you want to delete this artist?">
                <p:commandButton value="Yes, Delete"
                                 update=":artistsForm:artistsTable :artistsForm:msgs"
                                 actionListener="#{adminArtistsBean.deleteArtist(adminArtistsBean.artistToDeleteId)}"
                                 oncomplete="PF('confirmDel').hide();" />
                <p:commandButton value="Cancel" type="button"
                                 styleClass="ui-button-secondary"
                                 onclick="PF('confirmDel').hide();" />
            </p:confirmDialog>

        </h:form>
    </ui:define>
</ui:composition>