<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                template="/web/templates/layout.xhtml">

    <ui:define name="title">Admin — Designs | InkFlow</ui:define>
    <ui:define name="pageTitle">Design Management</ui:define>

    <ui:define name="content">

        <h:form id="designsForm">

            <p:growl id="msgs" showDetail="true" life="3500" />

            <!-- ============================ -->
            <!-- TABLE: All Tattoo Designs     -->
            <!-- ============================ -->
            <p:dataTable id="designsTable"
                         value="#{adminDesignBean.designs}"
                         var="d"
                         paginator="true"
                         rows="12"
                         rowKey="#{d.designId}"
                         style="margin-top:10px">

                <!-- ID -->
                <p:column headerText="ID" width="60">
                    #{d.designId}
                </p:column>

                <!-- Thumbnail -->
                <p:column headerText="Image" width="110">
                    <h:graphicImage value="#{d.imagePath}"
                                    style="width:80px; height:80px; object-fit:cover; border-radius:6px;" />
                </p:column>

                <!-- Title -->
                <p:column headerText="Title">
                    <b>#{d.title}</b><br/>
                    <small class="muted">#{d.style}</small>
                </p:column>

                <!-- Artist -->
                <p:column headerText="Artist">
                    #{d.artist.fullName}<br/>
                    <small class="muted">#{d.artist.username}</small>
                </p:column>

                <!-- Price -->
                <p:column headerText="Price" width="120">
                    ₹#{d.price}
                </p:column>

                <!-- Status -->
                <p:column headerText="Status" width="150">
                    <h:outputText value="Active"
                                  rendered="#{!d.isBanned}"
                                  style="color:green; font-weight:bold;" />

                    <h:outputText value="Banned"
                                  rendered="#{d.isBanned}"
                                  style="color:red; font-weight:bold;" />
                </p:column>

                <!-- ACTION BUTTONS -->
                <p:column headerText="Actions" width="250">

                    <!-- VIEW -->
                    <p:commandButton icon="pi pi-eye"
                                     title="View Design"
                                     process="@this"
                                     update=":designsForm:viewDialog :designsForm:msgs"
                                     actionListener="#{adminDesignBean.setSelectedDesignId(d.designId)}"
                                     oncomplete="PF('viewDlg').show()"/>

                    <!-- BAN -->
                    <p:commandButton icon="pi pi-ban"
                                     title="Ban Design"
                                     rendered="#{!d.isBanned}"
                                     style="margin-left:6px"
                                     process="@this"
                                     actionListener="#{adminDesignBean.setSelectedDesignId(d.designId)}"
                                     update=":designsForm:banDialog"
                                     oncomplete="PF('banDlg').show()"/>

                    <!-- UNBAN -->
                    <p:commandButton icon="pi pi-check"
                                     title="Unban"
                                     rendered="#{d.isBanned}"
                                     style="margin-left:6px"
                                     action="#{adminDesignBean.unbanDesign(d.designId)}"
                                     update=":designsForm:designsTable :designsForm:msgs"/>

                    <!-- DELETE -->
<!--                    <p:commandButton icon="pi pi-trash"
                                     style="margin-left:6px"
                                     onclick="PF('confirmDelete').show(); return false;">
                        <f:setPropertyActionListener  
                                target="#{adminDesignBean.selectedDesignId}"  
                                value="#{d.designId}" />
                    </p:commandButton>-->

                </p:column>

            </p:dataTable>

            <!-- ============================ -->
            <!-- VIEW DESIGN DIALOG -->
            <!-- ============================ -->
            <p:dialog id="viewDialog"
          widgetVar="viewDlg"
          header="Design Details"
          modal="true"
          resizable="false"
          appendTo="@(body)"
          width="450">

    <h:panelGrid columns="2" columnClasses="label,value" style="width:100%">

        <h:outputText value="ID:" />
        <h:outputText value="#{adminDesignBean.selectedDesignId}" />

        <h:outputText value="Image:" />
        <h:panelGroup rendered="#{not empty adminDesignBean.selectedDesign}">
            <h:graphicImage value="#{adminDesignBean.selectedDesign.imagePath}"
                            style="width:180px; border-radius:8px;" />
        </h:panelGroup>

    </h:panelGrid>

</p:dialog>

            <!-- ============================ -->
            <!-- BAN DIALOG -->
            <!-- ============================ -->
            <p:dialog id="banDialog"
                      widgetVar="banDlg"
                      header="Ban Design"
                      modal="true"
                      resizable="false"
                      appendTo="@(body)">

                <h:panelGrid columns="2" style="width:100%">
                    <h:outputLabel value="Reason:"/>
                    <h:inputTextarea value="#{adminDesignBean.banReason}" rows="4"/>
                </h:panelGrid>

                <p:commandButton value="Confirm Ban"
                                 style="margin-top:12px"
                                 action="#{adminDesignBean.banDesign}"
                                 update=":designsForm:designsTable :designsForm:msgs"
                                 oncomplete="PF('banDlg').hide()"/>
            </p:dialog>

            <!-- ============================ -->
            <!-- DELETE CONFIRM -->
            <!-- ============================ -->
            <p:confirmDialog widgetVar="confirmDelete"
                             header="Confirm Delete"
                             message="Are you sure you want to delete this design?">

                <p:commandButton value="Delete"
                                 action="#{adminDesignBean.deleteDesign(adminDesignBean.selectedDesignId)}"
                                 update=":designsForm:designsTable :designsForm:msgs"
                                 oncomplete="PF('confirmDelete').hide()"/>

                <p:commandButton value="Cancel"
                                 type="button"
                                 styleClass="ui-button-secondary"
                                 onclick="PF('confirmDelete').hide()"/>
            </p:confirmDialog>

        </h:form>
    </ui:define>

</ui:composition>